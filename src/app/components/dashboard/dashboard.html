<div class="dashboard-container">
  <!-- Header & Logo -->
  <a href="" target="_blank">
    <div class="logo-ribbon">
      <img
        class="image-logo"
        src=""
        alt="Logo"
      />
    </div>
  </a>

  <!-- User Header -->
  <h2 class="user-title">{{ username }}'s Claims</h2>

  <!-- Bulk Actions (only visible if at least one claim is selected) -->
<div class="bulk-actions-container">
  <!-- Delete Selected only shows if claims are selected -->
  <button 
    *ngIf="hasSelectedClaims()" 
    class="delete-selected-btn" 
    (click)="deleteSelectedClaims()">
    üóëÔ∏è Delete Selected
  </button>

  <!-- Export PDF always visible -->
  <button class="export-btn" (click)="exportToPDF()">üìÑ Export PDF</button>
</div>


  <!-- Claims Table -->
  <table class="claims-table">
    <thead>
      <tr>
        <th><input type="checkbox" (change)="toggleSelectAll($event)" [checked]="areAllSelected()" /></th>
        <th (click)="sortClaims('descriptioncode')">Description <span>{{ getSortIcon('descriptioncode') }}</span></th>
        <th (click)="sortClaims('procedurecode')">Procedure <span>{{ getSortIcon('procedurecode') }}</span></th>
        <th (click)="sortClaims('price')">Price <span>{{ getSortIcon('price') }}</span></th>
        <th (click)="sortClaims('datesubmitted')">Submitted On <span>{{ getSortIcon('datesubmitted') }}</span></th>
        <th>Actions</th>
      </tr>
      <tr class="column-filters">
        <th></th>
        <th><input type="text" placeholder="Search Description" [(ngModel)]="descriptionFilter" (input)="applyFiltersAndSorting()" /></th>
        <th><input type="text" placeholder="Search Procedure" [(ngModel)]="procedureFilter" (input)="applyFiltersAndSorting()" /></th>
        <th><input type="text" placeholder="Search Price" [(ngModel)]="priceFilter" (input)="applyFiltersAndSorting()" /></th>
        <th><input type="text" placeholder="Search Date" [(ngModel)]="dateFilter" (input)="applyFiltersAndSorting()" /></th>
        <th></th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let claim of filteredClaims; trackBy: trackByClaimId" [ngClass]="{'high-price': claim.price > 5000}">
        <td><input type="checkbox" [(ngModel)]="claim.selected" (change)="checkSelectionChange()" /></td>

        <!-- Edit Mode -->
        <ng-container *ngIf="editingClaim && editingClaim.claimid === claim.claimid; else displayMode">
          <td><input [(ngModel)]="editingClaim.descriptioncode" /></td>
          <td><input [(ngModel)]="editingClaim.procedurecode" /></td>
          <td>
            <input type="number" [(ngModel)]="editingClaim.price" />
            <span *ngIf="editingClaim.price > 5000" class="warning-text">‚ö†Ô∏è High Price! Verify manually.</span>
          </td>
          <td>{{ editingClaim.datesubmitted | date:'short' }}</td>
          <td>
            <button (click)="updateClaim()">Save</button>
            <button (click)="cancelEdit()">Cancel</button>
          </td>
        </ng-container>

        <!-- Display Mode -->
        <ng-template #displayMode>
          <td>{{ claim.descriptioncode }}</td>
          <td>{{ claim.procedurecode }}</td>
          <td>
            {{ claim.price }}
            <span *ngIf="claim.price > 5000" class="warning-text">‚ö†Ô∏è High Price! Verify manually.</span>
          </td>
          <td>{{ claim.datesubmitted | date:'short' }}</td>
          <td>
            <button class="edit-btn" (click)="editClaim(claim)">Edit</button>
            <button class="delete-btn" (click)="deleteClaim(claim.claimid)">Delete</button>
          </td>
        </ng-template>
      </tr>
    </tbody>
  </table>

  <!-- Add New Claim Form -->
  <div class="add-claim-form">
    <h3>Add New Claim</h3>
    <input type="text" [(ngModel)]="newClaim.descriptioncode" placeholder="Description" />
    <input type="text" [(ngModel)]="newClaim.procedurecode" placeholder="Procedure" />
    <input type="number" [(ngModel)]="newClaim.price" placeholder="Price" />
    <button class="add-claim-btn" (click)="addClaim()">Add Claim</button>
  </div>
</div>
